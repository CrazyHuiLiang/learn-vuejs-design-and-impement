<!DOCTYPE html>
<html> 
    <head>
        <title>8-3. 正确地设置元素属性</title>
        <meta charset="utf-8">
        <style>
            #foo {
                color: red;
            }
        </style>
    </head>
    <body>
        <div id="app2"></div>
        <script type="module">
            import {effect, ref} from 'vue';
            import {createRenderer} from './renderer.ts';


            // 渲染器除了要执行挂载之外，还需要执行更新动作
            // 通过将渲染器设计为可配置的通用渲染器，即可实现渲染到任意目标平台上
            (() => {
                // 是否应该作为 DOM Properties 设置（还是作为 Attributes 设置）
                function shouldSetAsProps(el, key, value) {
                    // input 元素的 form 属性对应的 DOM Properties 是只读的，需要使用 setAttribute 来设置
                    if (key === 'form' && el.tagName === 'INPUT') {
                        return false;
                    }
                    return key in el;
                }

                const renderer = createRenderer({
                    // 用于创建元素
                    createElement(tag) {
                        return document.createElement(tag);
                    },
                    // 用于设置元素的文本节点
                    setElementText(el, text) {
                        el.textContent = text;
                    },
                    // 用于在给定的 parent 下添加指定元素
                    insert(el, container, anchor = null) {
                        container.appendChild(el, anchor);
                    },
                    // 属性设置相关的操作
                    patchProps(el, key, prevValue, nextValue) {
                        if (shouldSetAsProps(el, key, nextValue)) {
                            const type = typeof el[key];
                            if (type === 'boolean' && nextValue === '') {
                                el[key] = true;
                            } else {
                                el[key] = nextValue;
                            }
                        } else {
                            el.setAttribute(key, nextValue);
                        }
                    }
                });

                const vnode = {
                    type: 'div',
                    props: {
                        id: 'foo',
                    },
                    children: [
                        {type: 'button', children: 'disabled', props: { disabled: '' }},
                        {type: 'button', children: 'enabled', props: { disabled: false }},
                        {type: 'button', children: 'disabled', props: { disabled: true }},
                        {type: 'input',  props: { form: 'form1', placeholder: 'input1' }},
                    ],
                };
                renderer.render(vnode, document.getElementById('app2'));
            })();
        </script>
    </body>
</html>